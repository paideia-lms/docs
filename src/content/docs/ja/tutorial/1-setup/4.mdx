---
type: tutorial
title: データベースマイグレーションの実行
description: |-
  Paideia LMSの始め方チュートリアル —
  データベーススキーマをセットアップするためにデータベースマイグレーションを実行する
i18nReady: true
---
import Checklist from '~/components/Checklist.astro';
import Box from '~/components/tutorial/Box.astro';
import PreCheck from '~/components/tutorial/PreCheck.astro';
import { Steps } from '@astrojs/starlight/components';
import Badge from "~/components/Badge.astro"

<PreCheck>
  - マイグレーションステータスを確認する
  - データベースマイグレーションを実行する
  - マイグレーションが正常に完了したことを確認する
</PreCheck>

## データベースマイグレーションの実行

Paideia LMSは、データベーススキーマをセットアップおよび更新するためにデータベースマイグレーションを使用します。最初にPaideia LMSを実行すると、起動時にマイグレーションが自動的に適用されます。ただし、CLIを使用してマイグレーションを手動で実行することもできます。

### マイグレーションステータスの確認

<Steps>
1. 現在のマイグレーションステータスを確認：

   ```bash
   ./paideia migrate status
   ```

   これにより、どのマイグレーションが適用され、どれが保留中かが表示されます。
</Steps>

### マイグレーションの実行

<Steps>
2. すべての保留中のマイグレーションを実行：

   ```bash
   ./paideia migrate up
   ```

   これにより、まだ実行されていないマイグレーションが適用されます。

   :::note[自動マイグレーション]
   `./paideia server`でPaideia LMSを起動すると、起動時にマイグレーションが自動的に適用されます。サーバーを起動する前にマイグレーションを適用したい場合にのみ、手動でマイグレーションを実行する必要があります。
   :::

3. マイグレーションが正常に完了したことを確認：

   ```bash
   ./paideia migrate status
   ```

   すべてのマイグレーションが「適用済み」と表示されるはずです。
</Steps>

### データベースバックアップ

<Steps>
4. （オプション）続行する前にデータベースバックアップを作成：

   ```bash
   ./paideia migrate dump -o backup-before-setup.sql
   ```

   これにより、必要に応じて復元できるデータベースのバックアップが作成されます。
</Steps>

:::tip[マイグレーションのベストプラクティス]

- マイグレーションを適用する前後でマイグレーションステータスを常に確認
- 本番環境でマイグレーションを実行する前にバックアップを作成
- まず開発環境でマイグレーションをテスト
- より多くのマイグレーションコマンドについては[CLIリファレンス](/ja/reference/cli-reference/)を確認
:::

<Box icon="check-list">
## チェックリスト

<Checklist>
- [ ] マイグレーションステータスを確認できる。
- [ ] データベースマイグレーションを実行できる。
- [ ] マイグレーションが正常に完了したことを確認した。
- [ ] データベースバックアップを作成した（オプション）。
</Checklist>
</Box>

### 参考

- <p>[CLIリファレンス](/ja/reference/cli-reference/) <Badge class="neutral-badge" text="内部" /> — Paideia LMS CLIコマンドの完全なリファレンス</p>
- <p>[Paideia LMSのアップグレード](/ja/upgrade/) <Badge class="neutral-badge" text="内部" /> — アップグレードとマイグレーション管理のガイド</p>
