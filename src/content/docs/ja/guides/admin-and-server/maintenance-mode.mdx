---
title: メンテナンスモード
description: メンテナンス期間中にシステムアクセスを制限する方法を学びます。
i18nReady: true
---

メンテナンスモードにより、管理者はメンテナンス期間中にシステムアクセスを制限できます。メンテナンスモードが有効になっている場合、管理者のみがシステムにアクセスでき、他のすべてのユーザーはログインがブロックされます。この機能により、メンテナンス中の制御されたアクセスを提供し、無限リダイレクトループを防ぎます。

## 概要

メンテナンスモードは、管理者が以下を実行できるシステム全体の機能です：

- **アクセス制限**: メンテナンス中に非管理者ユーザーのシステムアクセスをブロック
- **管理者アクセス**: 管理者はメンテナンスタスクを実行するためにシステムにアクセス可能
- **ユーザー通信**: ユーザーに明確なメンテナンスメッセージを表示
- **簡単な切り替え**: 管理インターフェースからメンテナンスモードを有効/無効化

## メンテナンスモードの有効化

メンテナンスモードを有効にするには：

1. 管理者としてログイン
2. **管理 → サーバー → メンテナンスモード**に移動
3. **「メンテナンスモードを有効化」**スイッチをオンに切り替え
4. **「変更を保存」**をクリック

システムはメンテナンスモードになりました。非管理者ユーザーがシステムにアクセスしようとすると、メンテナンスメッセージが表示されます。

![メンテナンスモードインターフェース](/gallery/maintenance-mode.webp)

## メンテナンスモードの無効化

メンテナンスモードを無効にするには：

1. 管理者としてログイン（まだログインしていない場合）
2. **管理 → サーバー → メンテナンスモード**に移動
3. **「メンテナンスモードを有効化」**スイッチをオフに切り替え
4. **「変更を保存」**をクリック

システムはすべてのユーザーがアクセス可能になりました。

## メンテナンス中のアクセス制御

メンテナンスモードが有効になっている場合、以下のアクセスルールが適用されます：

### 許可されたルート

- **`/login`** - 管理者がログインするため
- **`/admin/maintenance`** - 管理者がメンテナンスモードを無効化するため
- **`/api/*`** - APIアクセス（システム操作に必要になる場合があります）

### ブロックされたルート

- 非管理者ユーザーの他のすべてのルート
- ルートルート（`/`）は非管理者ユーザーにメンテナンスメッセージを表示

## ユーザーエクスペリエンス

### 非管理者ユーザー

メンテナンスモードが有効になっている場合、非管理者ユーザーは：

- ルートルートでメンテナンスメッセージを確認
- ログインページにアクセス可能（管理者ログインを許可）
- 明確なメッセージを確認：「システムは現在メンテナンス中です。後でもう一度お試しください。」

### 管理者

管理者は：

- すべてのルートに通常どおりアクセス可能
- メンテナンスページにアクセスしてメンテナンスモードを無効化可能
- 制限なくメンテナンスタスクを実行可能

## 技術詳細

### メンテナンス設定

メンテナンスモードは、Payload CMSの`MaintenanceSettings`グローバルコレクションに保存されます。設定には以下が含まれます：

- **`maintenanceMode`**: ブール値フィールド（デフォルト：`false`）
- 永続性のためにデータベースに保存
- 管理インターフェースからアクセス可能

### エラーハンドリング

システムには、無限リダイレクトループを防ぐための適切なエラーハンドリングが含まれています：

- リダイレクト前にルートルートにいるかどうかを確認
- ルートルートにいる場合、リダイレクトの代わりにエラーをスロー
- エラーバウンダリがメンテナンスメッセージを表示
- リダイレクトループを防止

### HTTPステータスコード

メンテナンスモードが有効になっている場合、システムは以下を返します：

- **HTTP 503**（サービス利用不可）ステータスコード
- ユーザーへの明確なエラーメッセージ
- エラーバウンダリでの適切なエラーハンドリング

## ベストプラクティス

### メンテナンスモードを有効にする前

1. **ユーザーに通知**: スケジュールされたメンテナンスについて事前にユーザーに通知
2. **メンテナンスを計画**: 低トラフィック期間中にメンテナンスをスケジュール
3. **アクセスをテスト**: 管理者がシステムにアクセスできることを確認
4. **ロールバックを準備**: 必要に応じてメンテナンスモードを無効化する方法を知る

### メンテナンス中

1. **アクセスを監視**: 管理者がシステムにアクセスできることを確認
2. **タスクを完了**: 必要なすべてのメンテナンスタスクを実行
3. **システムをテスト**: システムが正しく動作することを確認
4. **モードを無効化**: 完了したらメンテナンスモードを無効化

### メンテナンス後

1. **アクセスを確認**: すべてのユーザーがシステムにアクセスできることを確認
2. **機能を確認**: すべてが機能することを確認するために主要な機能をテスト
3. **ログを監視**: 問題がないかシステムログを確認
4. **ユーザーに通信**: メンテナンスが完了したことをユーザーに通知

## トラブルシューティング

### メンテナンスページにアクセスできない

メンテナンスページにアクセスできない場合：

1. 管理者としてログインしていることを確認
2. ルート`/admin/maintenance`がアクセス可能であることを確認
3. メンテナンスモードがアクセスをブロックしていないことを確認
4. まずログインページにアクセスしてみる

### メンテナンスモードが無効化できない

メンテナンスモードが無効化できない場合：

1. 管理者としてログインしていることを確認
2. 管理インターフェースでエラーメッセージを確認
3. データベース接続を確認
4. エラーのシステムログを確認

### 無限リダイレクトループ

無限リダイレクトループが発生する場合：

1. システムがこれを自動的に防ぐ必要があります
2. ルートルート（`/`）にいることを確認
3. エラーバウンダリが正しく動作していることを確認
4. エラーのシステムログを確認

## 関連機能

- [Cronジョブ](/ja/guides/admin-and-server/cron-jobs/) - スケジュールされたタスクを監視および管理
- [設定ガイド](/ja/guides/configuring-paideia/) - システム設定について学ぶ
- [環境変数](/ja/guides/environment-variables/) - システム設定を構成

