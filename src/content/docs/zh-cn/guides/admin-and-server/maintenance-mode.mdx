---
title: 维护模式
description: 了解如何在维护期间使用维护模式限制系统访问。
i18nReady: true
---

维护模式允许管理员在维护期间限制系统访问。启用维护模式后，只有管理员可以访问系统，而所有其他用户将被阻止登录。此功能在维护期间提供受控访问，同时防止无限重定向循环。

## 概述

维护模式是一个系统级功能，允许管理员：

- **限制访问**：在维护期间阻止非管理员用户访问系统
- **管理员访问**：管理员仍可访问系统以执行维护任务
- **用户通信**：向用户显示清晰的维护消息
- **轻松切换**：通过管理界面启用或禁用维护模式

## 启用维护模式

要启用维护模式：

1. 以管理员身份登录
2. 导航到 **管理 → 服务器 → 维护模式**
3. 将 **"启用维护模式"** 开关切换到开启
4. 点击 **"保存更改"**

系统现在处于维护模式。非管理员用户尝试访问系统时将看到维护消息。

![维护模式界面](/gallery/maintenance-mode.webp)

## 禁用维护模式

要禁用维护模式：

1. 以管理员身份登录（如果尚未登录）
2. 导航到 **管理 → 服务器 → 维护模式**
3. 将 **"启用维护模式"** 开关切换到关闭
4. 点击 **"保存更改"**

系统现在可供所有用户访问。

## 维护期间的访问控制

启用维护模式后，以下访问规则适用：

### 允许的路由

- **`/login`** - 供管理员登录
- **`/admin/maintenance`** - 供管理员禁用维护模式
- **`/api/*`** - 用于API访问（可能需要用于系统操作）

### 阻止的路由

- 非管理员用户的所有其他路由
- 根路由（`/`）为非管理员用户显示维护消息

## 用户体验

### 对于非管理员用户

启用维护模式后，非管理员用户将：

- 在根路由上看到维护消息
- 可以访问登录页面（允许管理员登录）
- 看到清晰的消息："系统当前正在维护中。请稍后再试。"

### 对于管理员

管理员可以：

- 正常访问所有路由
- 访问维护页面以禁用维护模式
- 不受限制地执行维护任务

## 技术细节

### 维护设置

维护模式存储在Payload CMS的`MaintenanceSettings`全局集合中。设置包括：

- **`maintenanceMode`**：布尔字段（默认：`false`）
- 存储在数据库中以便持久化
- 可通过管理界面访问

### 错误处理

系统包含适当的错误处理以防止无限重定向循环：

- 在重定向之前检查是否已在根路由上
- 如果在根路由上，则抛出错误而不是重定向
- 错误边界显示维护消息
- 防止重定向循环

### HTTP状态代码

启用维护模式时，系统返回：

- **HTTP 503**（服务不可用）状态代码
- 向用户显示清晰的错误消息
- 在错误边界中进行适当的错误处理

## 最佳实践

### 启用维护模式之前

1. **通知用户**：提前通知用户计划的维护
2. **计划维护**：在低流量期间安排维护
3. **测试访问**：验证管理员仍可访问系统
4. **准备回滚**：了解如何在需要时禁用维护模式

### 维护期间

1. **监控访问**：确保管理员可以访问系统
2. **完成任务**：执行所有必要的维护任务
3. **测试系统**：验证系统是否正常工作
4. **禁用模式**：完成后禁用维护模式

### 维护后

1. **验证访问**：确认所有用户都可以访问系统
2. **检查功能**：测试关键功能以确保一切正常
3. **监控日志**：检查系统日志是否有任何问题
4. **用户通信**：通知用户维护已完成

## 故障排除

### 无法访问维护页面

如果无法访问维护页面：

1. 确保您以管理员身份登录
2. 检查路由`/admin/maintenance`是否可访问
3. 验证维护模式是否阻止了您的访问
4. 尝试先访问登录页面

### 维护模式无法禁用

如果维护模式无法禁用：

1. 验证您是否以管理员身份登录
2. 检查管理界面中的错误消息
3. 验证数据库连接
4. 检查系统日志中的错误

### 无限重定向循环

如果遇到无限重定向循环：

1. 系统应自动防止这种情况
2. 检查您是否在根路由（`/`）上
3. 验证错误边界是否正常工作
4. 检查系统日志中的错误

## 相关功能

- [Cron作业](/zh-cn/guides/admin-and-server/cron-jobs/) - 监控和管理计划任务
- [配置指南](/zh-cn/guides/configuring-paideia/) - 了解系统配置
- [环境变量](/zh-cn/guides/environment-variables/) - 配置系统设置

