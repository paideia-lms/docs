---
type: tutorial
title: 运行数据库迁移
description: |-
  Paideia LMS 入门教程 —
  运行数据库迁移以设置数据库架构
---
import Checklist from '~/components/Checklist.astro';
import Box from '~/components/tutorial/Box.astro';
import PreCheck from '~/components/tutorial/PreCheck.astro';
import { Steps } from '@astrojs/starlight/components';
import Badge from "~/components/Badge.astro"

<PreCheck>
  - 检查迁移状态
  - 运行数据库迁移
  - 验证迁移是否成功完成
</PreCheck>

## 运行数据库迁移

Paideia LMS 使用数据库迁移来设置和更新数据库架构。当你首次运行 Paideia LMS 时，迁移会在启动时自动应用。但是，你也可以使用 CLI 手动运行迁移。

### 检查迁移状态

<Steps>
1. 检查当前迁移状态：

   ```bash
   ./paideia migrate status
   ```

   这将显示哪些迁移已应用，哪些待处理。
</Steps>

### 运行迁移

<Steps>
2. 运行所有待处理的迁移：

   ```bash
   ./paideia migrate up
   ```

   这将应用所有尚未执行的迁移。

   :::note[自动迁移]
   当你使用 `./paideia server` 启动 Paideia LMS 时，迁移会在启动时自动应用。只有在启动服务器之前想要应用迁移时，才需要手动运行迁移。
   :::

3. 验证迁移是否成功完成：

   ```bash
   ./paideia migrate status
   ```

   所有迁移现在应该显示为“已应用”。
</Steps>

### 数据库备份

<Steps>
4. （可选）在继续之前创建数据库备份：

   ```bash
   ./paideia migrate dump -o backup-before-setup.sql
   ```

   这将创建数据库的备份，如果需要可以恢复。
</Steps>

:::tip[迁移最佳实践]

- 在应用迁移前后始终检查迁移状态
- 在生产环境中运行迁移之前创建备份
- 首先在开发环境中测试迁移
- 查看 [CLI 参考](/zh-cn/reference/cli-reference/) 了解更多迁移命令
:::

<Box icon="check-list">

## 任务清单

<Checklist>
- [ ] 我可以检查迁移状态。
- [ ] 我可以运行数据库迁移。
- [ ] 我已经验证迁移成功完成。
- [ ] 我已经创建了数据库备份（可选）。
</Checklist>
</Box>

### 相关资源

- <p>[CLI 参考](/zh-cn/reference/cli-reference/) <Badge class="neutral-badge" text="内部链接" /> — Paideia LMS CLI 命令的完整参考</p>
- <p>[升级 Paideia LMS](/zh-cn/upgrade/) <Badge class="neutral-badge" text="内部链接" /> — 升级和管理迁移的指南</p>
